<!DOCTYPE html>
<html>
  <head>
    <title>Get Screen Details</title>
  </head>
  <body
    id="mybody"
    style="max-width: 100vw; max-height: 100vh; background: black"
  >
    <div id="app"></div>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/jsx">
      let colors = ["red", "blue", "green", "purple"];

      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      let identificator = Number(urlParams.get('screen'));

      // if(!identificator){
      //   for(let i = 0;i<4;i++){
      //     if(!localStorage.getItem(i)){
      //       location.replace(`Screen.html?screen=${i}`)
      //       break;
      //     }
      //   }
      // }

       localStorage.setItem(identificator, identificator)
       localStorage.setItem(`color-${identificator}`, colors[identificator])
       localStorage.setItem(`width-${identificator}`, window.innerWidth)
       localStorage.setItem(`height-${identificator}`, window.innerHeight)
       localStorage.setItem(`top-${identificator}`, window.screenTop)
       localStorage.setItem(`left-${identificator}`, window.screenLeft)
       console.log(localStorage)


        window.onbeforeunload = function(){
         localStorage.removeItem(identificator)
         localStorage.removeItem(`width-${identificator}`)
         localStorage.removeItem(`color-${identificator}`)
         localStorage.removeItem(`height-${identificator}`)
         localStorage.removeItem(`top-${identificator}`)
         localStorage.removeItem(`left-${identificator}`)
        }

        function Square ({ number=0, seconds=0, onRefresh, myTop, myLeft, myHeight, myWidth}) {
          let myColor = localStorage.getItem(`color-${number}`)
          React.useEffect(() => {
            // Refresh logic when needed
            if(number == identificator){
              localStorage.setItem(`width-${identificator}`, window.innerWidth)
              localStorage.setItem(`height-${identificator}`, window.innerHeight)
              localStorage.setItem(`top-${identificator}`, window.screenTop)
              localStorage.setItem(`left-${identificator}`, window.screenLeft)
            }
            onRefresh();
          }, [seconds, onRefresh]);

          return <div id="square"
          style={{
            width: 100 + number*20 + 'px',
            height:100 + number*20 + 'px',
            border:'2px solid ' + myColor,
            top: identificator !== number ? (myHeight/2)-(100+number*20)/2 -window.screenTop + myTop + 'px' : (myHeight/2)-(100+number*20)/2 + 'px',
            left: identificator !== number ? (myWidth/2)-(100+number*20)/2 -window.screenLeft+ myLeft +'px' : (myWidth/2)-(100+number*20)/2 +'px',
            transform:`rotate(${seconds%1440}deg)`
          }}
          ></div>
        }

      function Home (){
        let seconds = Math.round(Date.now() / 50);
        const [refresh, setRefresh] = React.useState(false); // Step 1
        React.useEffect(() => {
          seconds = Math.round(Date.now() / 50);
        });
        const handleRefresh = () => {
          setTimeout(()=>{
            setRefresh(!refresh);
          },5)

        };
        return <>{
          [0,1,2,3].map( (i) => i !== identificator && localStorage.getItem(i)?
            <Square
              key={i}
              number={i}
              seconds={seconds}
              myTop={Number(localStorage.getItem(`top-${i}`))}
              myLeft={Number(localStorage.getItem(`left-${i}`))}
              myHeight={Number(localStorage.getItem(`height-${i}`))}
              myWidth={Number(localStorage.getItem(`width-${i}`))}
              onRefresh={handleRefresh}
            />
          : i == identificator ? <Square
              key={i}
              number={i}
              seconds={seconds}
              myTop={window.screenTop}
              myLeft={window.screenLeft}
              myHeight={window.innerHeight}
              myWidth={window.innerWidth}
              onRefresh={handleRefresh}
            /> : null
          )
        }</>
      }

      const app = document.getElementById('app');
      ReactDOM.render(<Home />, app);
    </script>
    <style>
      #square {
        border-radius: 30px;
        position: fixed;
      }
    </style>
  </body>
</html>
